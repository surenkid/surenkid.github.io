---
layout: post
title: rsync镜像，搬家，增量备份等操作
date: 2016-06-15 14:43:00
category: 软件应用
permalink: /544.html
tags:
- scp
- ssh
- web
- 问题
- root
- 服务器
- 时间
- 内容
- 192.168.2.1
- rsync
- www
- 参数
---

<!--markdown-->很早就对服务器的搬家，备份等有过一些思考，之前在服务器数据搬家的过程中用的是[scp远程拷贝][1]，这也是一个比较方便的工具，对于备份来说，使用scp每次完整的拷贝一次显然是比较低效的。

而rsync则是一个更好用的增量同步工具，这个工具似乎被广泛应用于镜像，做双机热备用，它主要的优点是能对比文件的时间，内容等进行增量同步，避免的重复传输的资源消耗。除此之外，它能这么受到推崇，也许与它的功能强大有关，这里我从实际应用开始去了解，在使用中学相关的命令参数，Linux工具众多，能掌握足够自己使用的部分就已经很好了。

### 镜像与搬家
比如我们有一台生产服务器192.168.2.1，我们需要每天对这台服务器进行镜像，或者将一次性将服务器档案完全搬迁过来，这样服务端新增的文件同步过来，服务端删除的文件本地也删掉，与远端保持绝对一致，使用这个命令

    rsync -rave "ssh -p 22 -l root" --delete 192.168.2.1:/www/web/ /www/web/

其中-a表示归档模式，包含了一堆参数的集合，用上这个基本无忧。
接着-v表示输出信息，-e表示后面指定远程ssh。
由于有--delete，它表示远端没有的文件本地就删除掉，这个命令需要在前面加入-r。

### 增量备份
同上，但是不删除文件，这里只需要简单的去掉-r参数和--delete参数即可

    rsync -ave "ssh -p 22 -l root" 192.168.2.1:/www/web/ /www/web/

如果想了解参数的详细说明，可以参考[这里][2]了解。

实际在解决问题的过程中，使用工具虽然以“满足需求，够用”为原则，但是了解更多相关的用法，可以让你在解决复杂需求时，使用更酷更灵活的方式，让人各种刮目相看，这样当然是很好的:)


  [1]: http://hi.ktsee.com/193.html
  [2]: http://roclinux.cn/?p=2643